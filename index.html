<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keg washer Control</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container-fluid MainBox">
        <div class="headBox row">
            <div class="d-none d-md-block col-md-1"></div>
            <div class="h1Box col-12 col-md-5">
                <div class="H1">עדכון פרמטרים במשטף חביות</div>
            </div>
            <div class="col-12 col-md-3">
                <img  class="logo img-fluid" src="assets/pics/hatch_logoblack_clear_Background.png">
            </div> 
            <div class="col-12 col-md-2 HeadinfoBox">
                <div class="Headinfo">עדכון אחרון 04/11 17:09</div>
                <div class="Headinfo">V 5.1.1</div>
                <div class="Headinfo">&copy; ישראל אטלו</div>
            </div> 
            <div class="d-none d-md-block col-md-1"></div>
        </div>
     
        <form id="control-form" method="POST">
            <div class="formBox">
                <div class="functionBox container-fluid">
                    <div class="functionLabel row">שלב #1 דחיקת בירה החוצה עם אוויר</div>
                    <div class="functionInputs row">
                        <div class="col-12 col-md-3 ParamterBox">
                            <label for="FirstAirPurgeRecure">כמות חזרות</label>
                            <input type="number" id="FirstAirPurgeRecure" name="FirstAirPurgeRecure" required value="{{ settings['FirstAirPurgeRecure'] }}" placeholder="{{ settings['FirstAirPurgeRecure'] }}">
                        </div>
                        <div class="col-12 col-md-4 ParamterBox">
                            <label for="FirstAirPurgeTon">משך כניסת אוויר בכל חזרה בשניות</label>
                            <input type="number" id="FirstAirPurgeTon" name="FirstAirPurgeTon" required value="{{ settings['FirstAirPurgeTon'] }}">
                        </div>
                        <div class="col-12 col-md-5 ParamterBox">
                            <label for="FirstAirPurgeToff">משך ניקוז ללא אוויר בכל חזרה בשניות</label>
                            <input type="number" id="FirstAirPurgeToff" name="FirstAirPurgeToff" required value="{{ settings['FirstAirPurgeToff'] }}">
                        </div>
                    </div>
                </div>
                

                <button type="submit">Update</button>
                <button type="button" id="reset-btn">Reset to Default</button>
            </div>
        </form>
    </div>





    <script>
       $('#control-form').on('submit', function(e) {
            e.preventDefault(); // Prevent the default form submission

            // Prepare data to send
            const variableData = {
                index0: $('#FirstAirPurgeRecure').val() || 1, // Fallback to 0 if empty
                index1: $('#FirstAirPurgeTon').val() || 1, // Fallback to 0 if empty
                index2: $('#FirstAirPurgeToff').val() || 1.5  // Fallback to 0 if empty
            };

            // Log form data for debugging
            console.log('Form data:', variableData);

            // Send data to the Flask backend
            $.ajax({
                type: "POST",
                url: 'https://10.0.0.1:5000/update', // Update with your Raspberry Pi's IP
                data: variableData,
                cache: false,
                success: function(response) {
                    if (response.success) {
                        alert('Variables updated to: ' + JSON.stringify(response.new_values));
                        $('#FirstAirPurgeRecure').val(response.new_values[0]);
                        $('#FirstAirPurgeTon').val(response.new_values[1]);
                        $('#FirstAirPurgeToff').val(response.new_values[2]);
                    }
                },
                error: function(xhr, status, error) {
                    const errorMessage = xhr.responseJSON ? xhr.responseJSON.error : 'An unknown error occurred';
                    alert('Error: ' + errorMessage);
                    console.error('Error details:', xhr); // Log error details to the console
                }
            });
        });
        
        $('#reset-btn').on('click', function() {
        $.ajax({
            type: "POST",
            url: 'https://10.0.0.1:5000/reset',  // Ensure this matches the route for resetting to default
            success: function(response) {
                if (response.success) {
                    alert('Values reset to default: ' + JSON.stringify(response.new_values));
                    // Update the form values with the default values returned from the backend
                    $('#FirstAirPurgeRecure').val(response.new_values.FirstAirPurgeRecure);
                    $('#FirstAirPurgeTon').val(response.new_values.FirstAirPurgeTon);
                    $('#FirstAirPurgeToff').val(response.new_values.FirstAirPurgeToff);
                }
            }
        });
    });

</script>
</body>
</html>
